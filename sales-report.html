<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Product Sales Report</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    /* Custom scrollbar for better aesthetics */
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #e0f2fe; }
    ::-webkit-scrollbar-thumb { background: #7dd3fc; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #38bdf8; }
  </style>
</head>
<body class="bg-sky-50 min-h-screen font-sans">

  <nav class="bg-white shadow sticky top-0 z-10">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between items-center py-4">
            <h1 class="font-bold text-2xl text-slate-800">Product Sales Report</h1>
            <a href="reports.html" class="text-sm font-medium text-slate-600 hover:text-sky-600 flex items-center gap-1">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M11 17l-5-5m0 0l5-5m-5 5h12" />
                </svg>
                Back to Reports
            </a>
        </div>
    </div>
  </nav>

  <main class="p-4 sm:p-6 lg:p-8 max-w-7xl mx-auto">
    <div class="bg-white shadow-md rounded-2xl p-6 mb-6">
        <div class="flex flex-wrap items-center justify-between gap-4">
            <div class="flex flex-wrap items-center gap-4">
                <div>
                    <label for="timespanSelector" class="block text-sm font-medium text-slate-600 mb-1">Report Type</label>
                    <select id="timespanSelector" class="border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sky-200 focus:border-sky-500 transition">
                        <option value="daily">Daily</option>
                        <option value="weekly">Weekly</option>
                        <option value="monthly">Monthly</option>
                    </select>
                </div>
                <div>
                    <label for="chartTypeSelector" class="block text-sm font-medium text-slate-600 mb-1">Chart Type</label>
                    <select id="chartTypeSelector" class="border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sky-200 focus:border-sky-500 transition">
                        <option value="bar">Bar Chart</option>
                        <option value="line">Line Chart</option>
                        <option value="pie">Pie Chart</option>
                        <option value="doughnut">Doughnut Chart</option>
                    </select>
                </div>
                <div id="datePickerContainer">
                    <label for="reportDate" class="block text-sm font-medium text-slate-600 mb-1">Select Date</label>
                    <input type="date" id="reportDate" class="border border-slate-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-sky-200 focus:border-sky-500 transition">
                </div>
            </div>
            <button id="exportBtn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-2 px-4 rounded-lg shadow hover:shadow-md transition flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
                Export to Excel
            </button>
        </div>
    </div>

    <div class="bg-white shadow-md rounded-2xl p-6 mb-6">
        <h2 id="chartTitle" class="text-xl font-semibold text-slate-800 mb-4">Top Selling Products</h2>
        <div class="h-80">
             <canvas id="salesChart"></canvas>
        </div>
    </div>

    <div class="bg-white shadow-md rounded-2xl overflow-hidden">
      <h2 id="tableTitle" class="text-xl font-semibold text-slate-800 p-6">Full Sales Details</h2>
      <div class="overflow-x-auto">
        <table class="w-full text-sm text-left text-slate-500">
          <thead id="tableHeader" class="text-xs text-slate-700 uppercase bg-slate-100">
            </thead>
          <tbody id="salesTableBody">
            </tbody>
        </table>
      </div>
    </div>
  </main>

  <script>
    const productCatalog = [
        { id: 1, name: "Parle-G Gold", price: 10 }, { id: 2, name: "Lays Classic Chips", price: 20 },
        { id: 3, name: "Amul Gold Milk 1L", price: 70 }, { id: 4, name: "Cadbury Dairy Milk", price: 45 },
        { id: 5, name: "Maggi Noodles Pack", price: 56 }, { id: 6, name: "Coca-Cola 750ml", price: 40 },
        { id: 7, name: "Tata Salt 1kg", price: 25 }, { id: 8, name: "Cornetto Ice Cream", price: 50 },
        { id: 9, name: "Nescafe Coffee 50g", price: 155 }, { id: 10, name: "Britannia Good Day", price: 35 },
        { id: 11, name: "Aashirvaad Atta 5kg", price: 250 }, { id: 12, name: "Saffola Gold Oil 1L", price: 180 },
        { id: 13, name: "Farm Fresh Eggs (6)", price: 55 }, { id: 14, name: "Red Label Tea 250g", price: 130 },
        { id: 15, name: "Kissan Tomato Ketchup", price: 120 }, { id: 16, name: "Surf Excel Detergent 1kg", price: 210 },
        { id: 17, name: "Colgate MaxFresh", price: 95 }, { id: 18, name: "Dove Soap Bar", price: 60 },
        { id: 19, name: "Onion 1kg", price: 40 }, { id: 20, name: "Tomato 1kg", price: 30 }
    ];

    let currentSalesData = [];
    let salesChart;
    const datePicker = document.getElementById('reportDate');
    const timespanSelector = document.getElementById('timespanSelector');
    const chartTypeSelector = document.getElementById('chartTypeSelector');
    const exportBtn = document.getElementById('exportBtn');
    const chartTitle = document.getElementById('chartTitle');
    const tableTitle = document.getElementById('tableTitle');
    const tableHeader = document.getElementById('tableHeader');
    const datePickerContainer = document.getElementById('datePickerContainer');

    function seededRandom(seed) {
        let h = 1779033703 ^ seed.length;
        for(let i = 0; i < seed.length; i++) {
            h = Math.imul(h ^ seed.charCodeAt(i), 3432918353);
            h = h << 13 | h >>> 19;
        }
        return function() {
            h = Math.imul(h ^ h >>> 16, 2246822507);
            h = Math.imul(h ^ h >>> 13, 3266489909);
            return (h ^= h >>> 16) >>> 0;
        }
    }

    // --- DATA GENERATION ---
    function generateDailyData(dateStr) {
        const rand = seededRandom(dateStr);
        return productCatalog.map(p => ({
            ...p,
            quantitySold: Math.floor((rand() / 4294967295) * 100) + 5,
            get totalAmount() { return this.price * this.quantitySold }
        }));
    }

    function generateWeeklyData() {
        const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
        return days.map(day => ({
            name: day,
            totalAmount: Math.floor(Math.random() * 8000) + 15000
        }));
    }

    function generateMonthlyData() {
        const weeks = ["Week 1", "Week 2", "Week 3", "Week 4"];
        return weeks.map(week => ({
            name: week,
            totalAmount: Math.floor(Math.random() * 20000) + 80000
        }));
    }
    
    // --- UI & CHART RENDERING ---
    function updateControls() {
        const timespan = timespanSelector.value;
        const isDaily = timespan === 'daily';
        
        datePickerContainer.style.display = isDaily ? 'block' : 'none';
        
        // Enable/disable chart type options
        Array.from(chartTypeSelector.options).forEach(option => {
            if (!isDaily) {
                option.disabled = option.value !== 'line';
            } else {
                option.disabled = false;
            }
        });

        if (!isDaily) {
            chartTypeSelector.value = 'line';
        }
    }

    function updateReport() {
        const timespan = timespanSelector.value;
        const chartType = chartTypeSelector.value;
        const dateStr = datePicker.value;
        
        let tableHeadersHTML = '', tableBodyHTML = '', chartData, chartLabels, chartValues;
        let chartConfig = { type: chartType, options: { responsive: true, maintainAspectRatio: false, scales: {}, plugins: { legend: {} } } };

        if (timespan === 'daily') {
            currentSalesData = generateDailyData(dateStr);
            tableTitle.textContent = `Full Sales Details for ${dateStr}`;
            tableHeadersHTML = `<tr><th scope="col" class="px-6 py-3">Product Name</th><th scope="col" class="px-6 py-3 text-center">Quantity Sold</th><th scope="col" class="px-6 py-3 text-right">Price per Unit</th><th scope="col" class="px-6 py-3 text-right">Total Amount</th></tr>`;
            currentSalesData.forEach(item => {
                tableBodyHTML += `<tr class="bg-white border-b hover:bg-sky-50"><th scope="row" class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">${item.name}</th><td class="px-6 py-4 text-center">${item.quantitySold}</td><td class="px-6 py-4 text-right">₹${item.price.toFixed(2)}</td><td class="px-6 py-4 text-right font-semibold text-slate-800">₹${item.totalAmount.toFixed(2)}</td></tr>`;
            });
            
            const sortedData = [...currentSalesData].sort((a,b) => b.totalAmount - a.totalAmount).slice(0, 10);
            chartLabels = sortedData.map(d => d.name);

            if (chartType === 'pie' || chartType === 'doughnut') {
                chartTitle.textContent = 'Top 10 Products by Revenue';
                chartValues = sortedData.map(d => d.totalAmount);
                chartConfig.data = { labels: chartLabels, datasets: [{ label: 'Total Revenue', data: chartValues, backgroundColor: ['#0ea5e9', '#0284c7', '#0369a1', '#075985', '#0891b2', '#06b6d4', '#22d3ee', '#67e8f9', '#a5f3fc', '#cffafe'] }] };
                chartConfig.options.plugins.legend = { position: 'bottom', display: false };
            } else { // Bar or Line
                chartTitle.textContent = 'Top 10 Products by Quantity';
                chartValues = sortedData.map(d => d.quantitySold);
                chartConfig.data = { labels: chartLabels, datasets: [{ label: 'Quantity Sold', data: chartValues, backgroundColor: 'rgba(56, 189, 248, 0.6)', borderColor: 'rgba(14, 165, 233, 1)', borderWidth: 2, borderRadius: 8 }] };
                chartConfig.options.plugins.legend = { display: false };
                chartConfig.options.scales = { y: { beginAtZero: true, grid: { color: '#e0f2fe' } }, x: { grid: { display: false } } };
            }
        } else { // Weekly or Monthly
            const titlePrefix = timespan.charAt(0).toUpperCase() + timespan.slice(1);
            currentSalesData = (timespan === 'weekly') ? generateWeeklyData() : generateMonthlyData();
            chartTitle.textContent = `${titlePrefix} Sales Trend`;
            tableTitle.textContent = `${titlePrefix} Sales Summary`;
            tableHeadersHTML = `<tr><th scope="col" class="px-6 py-3">${titlePrefix === 'Weekly' ? 'Day' : 'Week'}</th><th scope="col" class="px-6 py-3 text-right">Total Sales Amount</th></tr>`;
            currentSalesData.forEach(item => {
                tableBodyHTML += `<tr class="bg-white border-b hover:bg-sky-50"><th scope="row" class="px-6 py-4 font-medium text-slate-900 whitespace-nowrap">${item.name}</th><td class="px-6 py-4 text-right font-semibold text-slate-800">₹${item.totalAmount.toLocaleString('en-IN')}</td></tr>`;
            });

            chartLabels = currentSalesData.map(d => d.name);
            chartValues = currentSalesData.map(d => d.totalAmount);
            chartConfig.type = 'line';
            chartConfig.data = { labels: chartLabels, datasets: [{ label: 'Total Sales (₹)', data: chartValues, backgroundColor: 'rgba(56, 189, 248, 0.2)', borderColor: 'rgba(14, 165, 233, 1)', borderWidth: 2, tension: 0.3, fill: true }] };
            chartConfig.options.plugins.legend = { display: false };
            chartConfig.options.scales = { y: { beginAtZero: false, grid: { color: '#e0f2fe' } }, x: { grid: { display: false } } };
        }
        
        tableHeader.innerHTML = tableHeadersHTML;
        document.getElementById('salesTableBody').innerHTML = tableBodyHTML;
        
        if (salesChart) { salesChart.destroy(); }
        salesChart = new Chart(document.getElementById('salesChart').getContext('2d'), chartConfig);
    }

    function exportToExcel() {
        const timespan = timespanSelector.value;
        const date = datePicker.value;
        let csvContent = "data:text/csv;charset=utf-8,";
        let headers, rows;
        
        if(timespan === 'daily') {
            headers = "Product Name,Quantity Sold,Price per Unit,Total Amount\r\n";
            rows = currentSalesData.map(item => `${item.name.replace(/,/g, '')},${item.quantitySold},${item.price.toFixed(2)},${item.totalAmount.toFixed(2)}`).join("\r\n");
        } else {
            headers = `${timespan === 'weekly' ? 'Day' : 'Week'},Total Sales\r\n`;
            rows = currentSalesData.map(item => `${item.name},${item.totalAmount}`).join("\r\n");
        }

        csvContent += headers + rows;
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download", `${timespan}_sales_report_${date}.csv`);
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    // --- EVENT LISTENERS & INITIAL LOAD ---
    datePicker.addEventListener('change', updateReport);
    timespanSelector.addEventListener('change', () => { updateControls(); updateReport(); });
    chartTypeSelector.addEventListener('change', updateReport);
    exportBtn.addEventListener('click', exportToExcel);

    const today = new Date().toISOString().split('T')[0];
    datePicker.value = today;
    updateControls();
    updateReport();
  </script>
</body>
</html>